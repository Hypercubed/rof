# Rule of Four

Determine the most resonable display format for a given numeric value. Using a modified version of the [rule of four](http://www.bmj.com/content/350/bmj.h1845) and other methods.

Goals:
  * Preserve display for integers and floats.
  * Limit to a precision of 2 or 3 following the rule of four.
  * Display the smaller of fixed or exponential formatting.

Coming soon?
  * Detemine optimal format give an array of values.

## Rule of Four (`ruleOfFour` function)

```
ruleOfFour(x: number): string
```

> The rule states: “Round the risk ratio to two significant digits if the leading non-zero digit is four or more, otherwise round to three;” it uses three decimal places for ratios in the range 0.040-0.399, two decimals for 0.40-3.99, one decimal for 4.0-39.9, and so on.
> -- [Setting number of decimal places for reporting risk ratios: rule of four](http://www.bmj.com/content/350/bmj.h1845).

|               Input Value |       toLocaleString |    toPrecision (N=3) |         Rule of Four |
|               ----------- |       -------------- |    ----------------- |         ------------ |
|                      0.04 |                 0.04 |               0.0400 |                0.040 |
|                       0.2 |                  0.2 |                0.200 |                0.200 |
|                       0.4 |                  0.4 |                0.400 |                 0.40 |
|                   2.00001 |                    2 |                 2.00 |                 2.00 |
|                   4.00001 |                    4 |                 4.00 |                  4.0 |
|                   20.0001 |                   20 |                 20.0 |                 20.0 |
|                   40.0001 |                   40 |                 40.0 |                   40 |
|                         2 |                    2 |                 2.00 |                 2.00 |
|                         4 |                    4 |                 4.00 |                  4.0 |
|                        20 |                   20 |                 20.0 |                 20.0 |
|                        40 |                   40 |                 40.0 |                   40 |
|                         0 |                    0 |                 0.00 |                 0.00 |
|                        -0 |                    0 |                 0.00 |                 0.00 |
|                  Infinity |                    ∞ |             Infinity |             Infinity |
|                 -Infinity |                   -∞ |            -Infinity |            -Infinity |

## `formatInteger` function

```
formatInteger(x: number): string
```

The `formatInteger` function returns the value formatted with the following rules:

* Returns `-0` if the value is `-0`
* Returns a string that is the smaller of the following:
  * The result of `Math.round(x).toLocaleString()`
  * The result of `Math.round(x).toExponential(N)` where N is the presision following the rule of four.

|               Input Value |       toLocaleString |    toPrecision (N=3) |         Rule of Four |        formatInteger |
|               ----------- |       -------------- |    ----------------- |         ------------ |               ------ |
|                      0.04 |                 0.04 |               0.0400 |                0.040 |                    0 |
|                       0.2 |                  0.2 |                0.200 |                0.200 |                    0 |
|                       0.4 |                  0.4 |                0.400 |                 0.40 |                    0 |
|                   2.00001 |                    2 |                 2.00 |                 2.00 |                    2 |
|                   4.00001 |                    4 |                 4.00 |                  4.0 |                    4 |
|                   20.0001 |                   20 |                 20.0 |                 20.0 |                   20 |
|                   40.0001 |                   40 |                 40.0 |                   40 |                   40 |
|                         2 |                    2 |                 2.00 |                 2.00 |                    2 |
|                         4 |                    4 |                 4.00 |                  4.0 |                    4 |
|                        20 |                   20 |                 20.0 |                 20.0 |                   20 |
|                        40 |                   40 |                 40.0 |                   40 |                   40 |
|                         0 |                    0 |                 0.00 |                 0.00 |                    0 |
|                        -0 |                    0 |                 0.00 |                 0.00 |                   -0 |
|                  Infinity |                    ∞ |             Infinity |             Infinity |                    ∞ |
|                 -Infinity |                   -∞ |            -Infinity |            -Infinity |                   -∞ |

## `formatDecimal` function

```
formatDecimal(x: number): string
```

The `formatDecimal` function returns the value formatted with the following rules:

* Returns `x.toLocaleString()` for `Infinity` and `-Infinity`.
* Returns `-0.00` if the value is `-0`
* Returns a string that is the smaller of the following:
  * The result of `x.toExponential(N)` where N is the presision following the rule of four.
  * The result of:
    * `x.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})` if `Math.abs(x) >= 0.4`
    * `x.toPrecision(N)` otherwise, where N is the presision following the rule of four.

|               Input Value |       toLocaleString |    toPrecision (N=3) |         Rule of Four |        formatDecimal |
|               ----------- |       -------------- |    ----------------- |         ------------ |               ------ |
|                      0.04 |                 0.04 |               0.0400 |                0.040 |                0.040 |
|                       0.2 |                  0.2 |                0.200 |                0.200 |                0.200 |
|                       0.4 |                  0.4 |                0.400 |                 0.40 |                 0.40 |
|                   2.00001 |                    2 |                 2.00 |                 2.00 |                 2.00 |
|                   4.00001 |                    4 |                 4.00 |                  4.0 |                 4.00 |
|                   20.0001 |                   20 |                 20.0 |                 20.0 |                20.00 |
|                   40.0001 |                   40 |                 40.0 |                   40 |                40.00 |
|                         2 |                    2 |                 2.00 |                 2.00 |                 2.00 |
|                         4 |                    4 |                 4.00 |                  4.0 |                 4.00 |
|                        20 |                   20 |                 20.0 |                 20.0 |                20.00 |
|                        40 |                   40 |                 40.0 |                   40 |                40.00 |
|                         0 |                    0 |                 0.00 |                 0.00 |                 0.00 |
|                        -0 |                    0 |                 0.00 |                 0.00 |                -0.00 |
|                  Infinity |                    ∞ |             Infinity |             Infinity |                    ∞ |
|                 -Infinity |                   -∞ |            -Infinity |            -Infinity |                   -∞ |

## `format` function

```
format(x: number): string
```

The `format` function returns the value formatted with the following rules:

* Returns `formatInteger(x)` if `x` is an integer defined by `parseInt(x) === parseFloat(x)`.
* Returns `formatDecimal(x)` otherwise.

|               Input Value |       toLocaleString |    toPrecision (N=3) |         Rule of Four |               format |
|               ----------- |       -------------- |    ----------------- |         ------------ |               ------ |
|                      0.04 |                 0.04 |               0.0400 |                0.040 |                0.040 |
|                       0.2 |                  0.2 |                0.200 |                0.200 |                0.200 |
|                       0.4 |                  0.4 |                0.400 |                 0.40 |                 0.40 |
|                   2.00001 |                    2 |                 2.00 |                 2.00 |                 2.00 |
|                   4.00001 |                    4 |                 4.00 |                  4.0 |                 4.00 |
|                   20.0001 |                   20 |                 20.0 |                 20.0 |                20.00 |
|                   40.0001 |                   40 |                 40.0 |                   40 |                40.00 |
|                         2 |                    2 |                 2.00 |                 2.00 |                    2 |
|                         4 |                    4 |                 4.00 |                  4.0 |                    4 |
|                        20 |                   20 |                 20.0 |                 20.0 |                   20 |
|                        40 |                   40 |                 40.0 |                   40 |                   40 |
|                         0 |                    0 |                 0.00 |                 0.00 |                    0 |
|                        -0 |                    0 |                 0.00 |                 0.00 |                   -0 |
|                  Infinity |                    ∞ |             Infinity |             Infinity |                    ∞ |
|                 -Infinity |                   -∞ |            -Infinity |            -Infinity |                   -∞ |

Other sample outputs below:

### Integers

|               Input Value |       toLocaleString |    toPrecision (N=3) |         Rule of Four |               format |
|               ----------- |       -------------- |    ----------------- |         ------------ |               ------ |
|                         4 |                    4 |                 4.00 |                  4.0 |                    4 |
|                        36 |                   36 |                 36.0 |                 36.0 |                   36 |
|                        21 |                   21 |                 21.0 |                 21.0 |                   21 |
|                       372 |                  372 |                  372 |                  372 |                  372 |
|                       961 |                  961 |                  961 |               9.6e+2 |                  961 |
|                      2560 |                2,560 |              2.56e+3 |              2.56e+3 |                2,560 |
|                      3615 |                3,615 |              3.62e+3 |              3.62e+3 |                3,615 |
|                     32139 |               32,139 |              3.21e+4 |              3.21e+4 |               32,139 |
|                     40744 |               40,744 |              4.07e+4 |               4.1e+4 |               40,744 |
|                    262537 |              262,537 |              2.63e+5 |              2.63e+5 |              262,537 |
|                    478068 |              478,068 |              4.78e+5 |               4.8e+5 |              478,068 |
|                   1815287 |            1,815,287 |              1.82e+6 |              1.82e+6 |             1.815e+6 |
|                   4655103 |            4,655,103 |              4.66e+6 |               4.7e+6 |              4.66e+6 |
|                  45187521 |           45,187,521 |              4.52e+7 |               4.5e+7 |              4.52e+7 |
|                  96028500 |           96,028,500 |              9.60e+7 |               9.6e+7 |              9.60e+7 |
|                 462121374 |          462,121,374 |              4.62e+8 |               4.6e+8 |              4.62e+8 |
|                        -3 |                   -3 |                -3.00 |                -3.00 |                   -3 |
|                        -7 |                   -7 |                -7.00 |                 -7.0 |                   -7 |
|                       -49 |                  -49 |                -49.0 |                  -49 |                  -49 |
|                      -299 |                 -299 |                 -299 |                 -299 |                 -299 |
|                      -699 |                 -699 |                 -699 |              -7.0e+2 |                 -699 |
|                     -1422 |               -1,422 |             -1.42e+3 |             -1.42e+3 |               -1,422 |
|                     -1573 |               -1,573 |             -1.57e+3 |             -1.57e+3 |               -1,573 |
|                    -16539 |              -16,539 |             -1.65e+4 |             -1.65e+4 |              -16,539 |
|                    -32001 |              -32,001 |             -3.20e+4 |             -3.20e+4 |              -32,001 |
|                   -307657 |             -307,657 |             -3.08e+5 |             -3.08e+5 |             -307,657 |
|                   -643207 |             -643,207 |             -6.43e+5 |              -6.4e+5 |             -643,207 |
|                  -3890722 |           -3,890,722 |             -3.89e+6 |             -3.89e+6 |            -3.891e+6 |
|                  -4272839 |           -4,272,839 |             -4.27e+6 |              -4.3e+6 |             -4.27e+6 |
|                 -33589995 |          -33,589,995 |             -3.36e+7 |             -3.36e+7 |            -3.359e+7 |
|                 -40342237 |          -40,342,237 |             -4.03e+7 |              -4.0e+7 |             -4.03e+7 |
|                -439578511 |         -439,578,511 |             -4.40e+8 |              -4.4e+8 |             -4.40e+8 |



### Floats

|               Input Value |       toLocaleString |    toPrecision (N=3) |         Rule of Four |               format |
|               ----------- |       -------------- |    ----------------- |         ------------ |               ------ |
|       0.41323993455618124 |                0.413 |                0.413 |                 0.41 |                 0.41 |
|        0.9235067101886096 |                0.924 |                0.924 |                 0.92 |                 0.92 |
|         8.040657133286029 |                8.041 |                 8.04 |                  8.0 |                 8.04 |
|        41.224588523152185 |               41.225 |                 41.2 |                   41 |                41.22 |
|        20.108736150074602 |               20.109 |                 20.1 |                 20.1 |                20.11 |
|         292.5502792714638 |               292.55 |                  293 |                  293 |               292.55 |
|        60.814599721359386 |               60.815 |                 60.8 |                   61 |                60.81 |
|        2291.6096599880966 |             2,291.61 |              2.29e+3 |              2.29e+3 |             2,291.61 |
|          5513.80475307339 |            5,513.805 |              5.51e+3 |               5.5e+3 |             5,513.80 |
|         20198.20390837329 |           20,198.204 |              2.02e+4 |              2.02e+4 |            20,198.20 |
|        19421.906208139284 |           19,421.906 |              1.94e+4 |              1.94e+4 |            19,421.91 |
|         50725.87994405542 |            50,725.88 |              5.07e+4 |               5.1e+4 |              5.07e+4 |
|          642127.895273253 |          642,127.895 |              6.42e+5 |               6.4e+5 |              6.42e+5 |
|        2924441.6719277534 |        2,924,441.672 |              2.92e+6 |              2.92e+6 |             2.924e+6 |
|         8343680.035214161 |        8,343,680.035 |              8.34e+6 |               8.3e+6 |              8.34e+6 |
|        10538868.103610788 |       10,538,868.104 |              1.05e+7 |              1.05e+7 |             1.054e+7 |
|          56302007.3219403 |       56,302,007.322 |              5.63e+7 |               5.6e+7 |              5.63e+7 |
|        367250898.01394254 |      367,250,898.014 |              3.67e+8 |              3.67e+8 |             3.673e+8 |
|       0.05024736149073599 |                 0.05 |               0.0502 |                0.050 |                0.050 |
|        0.2964218349533976 |                0.296 |                0.296 |                0.296 |                0.296 |
|     0.0038031700546621305 |                0.004 |              0.00380 |              0.00380 |              0.00380 |
|      0.041301530332525184 |                0.041 |               0.0413 |                0.041 |                0.041 |
|     0.0006387391300318088 |                0.001 |             0.000639 |              0.00064 |              0.00064 |
|     0.0003462354736737017 |                    0 |             0.000346 |             0.000346 |             0.000346 |
|   0.000056758810419396035 |                    0 |            0.0000568 |             0.000057 |             0.000057 |
|     0.0003123911089538929 |                    0 |             0.000312 |             0.000312 |             0.000312 |
|   0.000006534498512742362 |                    0 |           0.00000653 |            0.0000065 |              6.53e-6 |
|    0.00003251736524953809 |                    0 |            0.0000325 |            0.0000325 |            0.0000325 |
|     2.9121836549500556e-7 |                    0 |              2.91e-7 |              2.91e-7 |              2.91e-7 |
|  0.0000010331317536846351 |                    0 |           0.00000103 |           0.00000103 |             1.033e-6 |
|      9.984566122905267e-8 |                    0 |              9.98e-8 |               1.0e-7 |               1.0e-7 |
|     1.6655722652985725e-7 |                    0 |              1.67e-7 |              1.67e-7 |              1.67e-7 |
|       9.60856303500864e-9 |                    0 |              9.61e-9 |               9.6e-9 |               9.6e-9 |
|     2.4150224844850285e-8 |                    0 |              2.42e-8 |              2.42e-8 |              2.42e-8 |
|       -0.2905105641373624 |               -0.291 |               -0.291 |               -0.291 |               -0.291 |
|       -2.3114673190109003 |               -2.311 |                -2.31 |                -2.31 |                -2.31 |
|        -8.889699237729609 |                -8.89 |                -8.89 |                 -8.9 |                -8.89 |
|       -26.622272170630488 |              -26.622 |                -26.6 |                -26.6 |               -26.62 |
|        -99.46794078491953 |              -99.468 |                -99.5 |                  -99 |               -99.47 |
|       -47.394536817579876 |              -47.395 |                -47.4 |                  -47 |               -47.39 |
|        -763.7120057199604 |             -763.712 |                 -764 |              -7.6e+2 |              -763.71 |
|       -3454.7352528498163 |           -3,454.735 |             -3.45e+3 |             -3.45e+3 |            -3,454.74 |
|       -1474.7424958098843 |           -1,474.742 |             -1.47e+3 |             -1.47e+3 |            -1,474.74 |
|        -4266.301579483911 |           -4,266.302 |             -4.27e+3 |              -4.3e+3 |            -4,266.30 |
|        -70260.18214018235 |          -70,260.182 |             -7.03e+4 |              -7.0e+4 |             -7.03e+4 |
|        -36062.68226637288 |          -36,062.682 |             -3.61e+4 |             -3.61e+4 |           -36,062.68 |
|        -571873.4469470145 |         -571,873.447 |             -5.72e+5 |              -5.7e+5 |             -5.72e+5 |
|       -1007777.2578222511 |       -1,007,777.258 |             -1.01e+6 |             -1.01e+6 |            -1.008e+6 |
|       -3880250.1370304455 |       -3,880,250.137 |             -3.88e+6 |             -3.88e+6 |            -3.880e+6 |
|        -34407272.91541256 |      -34,407,272.915 |             -3.44e+7 |             -3.44e+7 |            -3.441e+7 |
|       -16521613.335154982 |      -16,521,613.335 |             -1.65e+7 |             -1.65e+7 |            -1.652e+7 |
|       -411776060.97028184 |      -411,776,060.97 |             -4.12e+8 |              -4.1e+8 |             -4.12e+8 |
|     -0.057816419826811384 |               -0.058 |              -0.0578 |               -0.058 |               -0.058 |
|     -0.007607975191848304 |               -0.008 |             -0.00761 |              -0.0076 |              -0.0076 |
|    -0.0038572299171903057 |               -0.004 |             -0.00386 |             -0.00386 |             -0.00386 |
|      -0.04680128442214269 |               -0.047 |              -0.0468 |               -0.047 |               -0.047 |
|   -0.00006055183482672155 |                   -0 |           -0.0000606 |            -0.000061 |            -0.000061 |
|      -0.00260726317033116 |               -0.003 |             -0.00261 |             -0.00261 |             -0.00261 |
| -0.0000031958411393073317 |                   -0 |          -0.00000320 |          -0.00000320 |            -3.196e-6 |
|   -0.00014051361731011314 |                   -0 |            -0.000141 |            -0.000141 |            -0.000141 |
|  -0.000004123805074418768 |                   -0 |          -0.00000412 |           -0.0000041 |             -4.12e-6 |
|   -0.00003472372638188188 |                   -0 |           -0.0000347 |           -0.0000347 |           -0.0000347 |
|    -2.1324347913827023e-7 |                   -0 |             -2.13e-7 |             -2.13e-7 |             -2.13e-7 |
|     -8.992157354897923e-7 |                   -0 |             -8.99e-7 |              -9.0e-7 |              -9.0e-7 |
|    -5.8627899075616674e-8 |                   -0 |             -5.86e-8 |              -5.9e-8 |              -5.9e-8 |
|     -3.271811765633412e-7 |                   -0 |             -3.27e-7 |             -3.27e-7 |             -3.27e-7 |
|    -2.7703967490922256e-9 |                   -0 |             -2.77e-9 |             -2.77e-9 |             -2.77e-9 |
|       -8.9410994253332e-9 |                   -0 |             -8.94e-9 |              -8.9e-9 |              -8.9e-9 |

### Special

|               Input Value |       toLocaleString |    toPrecision (N=3) |         Rule of Four |               format |
|               ----------- |       -------------- |    ----------------- |         ------------ |               ------ |
|                       NaN |                  NaN |                  NaN |                  NaN |                  NaN |
|                     1 + 2 |                    3 |                 3.00 |                 3.00 |                    3 |
|            (0.1 + 0.2)*10 |                    3 |                 3.00 |                 3.00 |                 3.00 |
|                        PI |                3.142 |                 3.14 |                 3.14 |                 3.14 |
|                         E |                2.718 |                 2.72 |                 2.72 |                 2.72 |
|                     SQRT2 |                1.414 |                 1.41 |                 1.41 |                 1.41 |
|                   EPSILON |                    0 |             2.22e-16 |             2.22e-16 |             2.22e-16 |
