# Rule of Four

Determine the most reasonable display format for a given numeric value. Using a modified version of the [rule of four](http://www.bmj.com/content/350/bmj.h1845) and other methods.

Goals:
  * Preserve display for integers and floats.
  * Limit to a precision of 2 or 3 following the rule of four.
  * Display the smaller of fixed or exponential formatting.

Coming soon?
  * Determine optimal format give an array of values.

## Rule of Four (`ruleOfFour` function)

```
ruleOfFour(x: number): string
```

> The rule states: “Round the risk ratio to two significant digits if the leading non-zero digit is four or more, otherwise round to three;” it uses three decimal places for ratios in the range 0.040-0.399, two decimals for 0.40-3.99, one decimal for 4.0-39.9, and so on.
> -- [Setting number of decimal places for reporting risk ratios: rule of four](http://www.bmj.com/content/350/bmj.h1845).

|               Input Value |       toLocaleString |    toPrecision (N=3) |         Rule of Four |
|               ----------- |       -------------- |    ----------------- |         ------------ |
|                      0.04 |                 0.04 |               0.0400 |                0.040 |
|                       0.2 |                  0.2 |                0.200 |                0.200 |
|                       0.4 |                  0.4 |                0.400 |                 0.40 |
|                   2.00001 |                    2 |                 2.00 |                 2.00 |
|                   4.00001 |                    4 |                 4.00 |                  4.0 |
|                   20.0001 |                   20 |                 20.0 |                 20.0 |
|                   40.0001 |                   40 |                 40.0 |                   40 |
|                         2 |                    2 |                 2.00 |                 2.00 |
|                         4 |                    4 |                 4.00 |                  4.0 |
|                        20 |                   20 |                 20.0 |                 20.0 |
|                        40 |                   40 |                 40.0 |                   40 |
|                         0 |                    0 |                 0.00 |                 0.00 |
|                        -0 |                    0 |                 0.00 |                 0.00 |
|                  Infinity |                    ∞ |             Infinity |             Infinity |
|                 -Infinity |                   -∞ |            -Infinity |            -Infinity |

## `formatInteger` function

```
formatInteger(x: number): string
```

The `formatInteger` function returns the value formatted with the following rules:

* `-0` if the `Math.round(x)` is `-0`.
* `Math.round(x).toLocaleString()` if the character length is <= 9.
* `Math.round(x).toExponential(N)` (where N is the precision following the rule of four) otherwise.

|               Input Value |       toLocaleString |    toPrecision (N=3) |         Rule of Four |        formatInteger |
|               ----------- |       -------------- |    ----------------- |         ------------ |               ------ |
|                      0.04 |                 0.04 |               0.0400 |                0.040 |                    0 |
|                       0.2 |                  0.2 |                0.200 |                0.200 |                    0 |
|                       0.4 |                  0.4 |                0.400 |                 0.40 |                    0 |
|                   2.00001 |                    2 |                 2.00 |                 2.00 |                    2 |
|                   4.00001 |                    4 |                 4.00 |                  4.0 |                    4 |
|                   20.0001 |                   20 |                 20.0 |                 20.0 |                   20 |
|                   40.0001 |                   40 |                 40.0 |                   40 |                   40 |
|                         2 |                    2 |                 2.00 |                 2.00 |                    2 |
|                         4 |                    4 |                 4.00 |                  4.0 |                    4 |
|                        20 |                   20 |                 20.0 |                 20.0 |                   20 |
|                        40 |                   40 |                 40.0 |                   40 |                   40 |
|                         0 |                    0 |                 0.00 |                 0.00 |                    0 |
|                        -0 |                    0 |                 0.00 |                 0.00 |                   -0 |
|                  Infinity |                    ∞ |             Infinity |             Infinity |                    ∞ |
|                 -Infinity |                   -∞ |            -Infinity |            -Infinity |                   -∞ |

## `formatDecimal` function

```
formatDecimal(x: number): string
```

The `formatDecimal` function returns the value formatted with the following rules:

* `-0.00` if the value is `-0`.
* `x.toPrecision(N)` (where N is the precision following the rule of four) if `Math.abs(x) < 0.4` and the character length is <= 9.
* `x.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})` if `Math.abs(x) >= 0.4` and the character length is <= 9.
* `x.toExponential(N)` (where N is the precision following the rule of four) otherwise

|               Input Value |       toLocaleString |    toPrecision (N=3) |         Rule of Four |        formatDecimal |
|               ----------- |       -------------- |    ----------------- |         ------------ |               ------ |
|                      0.04 |                 0.04 |               0.0400 |                0.040 |                0.040 |
|                       0.2 |                  0.2 |                0.200 |                0.200 |                0.200 |
|                       0.4 |                  0.4 |                0.400 |                 0.40 |                 0.40 |
|                   2.00001 |                    2 |                 2.00 |                 2.00 |                 2.00 |
|                   4.00001 |                    4 |                 4.00 |                  4.0 |                 4.00 |
|                   20.0001 |                   20 |                 20.0 |                 20.0 |                20.00 |
|                   40.0001 |                   40 |                 40.0 |                   40 |                40.00 |
|                         2 |                    2 |                 2.00 |                 2.00 |                 2.00 |
|                         4 |                    4 |                 4.00 |                  4.0 |                 4.00 |
|                        20 |                   20 |                 20.0 |                 20.0 |                20.00 |
|                        40 |                   40 |                 40.0 |                   40 |                40.00 |
|                         0 |                    0 |                 0.00 |                 0.00 |                 0.00 |
|                        -0 |                    0 |                 0.00 |                 0.00 |                -0.00 |
|                  Infinity |                    ∞ |             Infinity |             Infinity |                    ∞ |
|                 -Infinity |                   -∞ |            -Infinity |            -Infinity |                   -∞ |

## `format` function

```
format(x: number): string
```

The `format` function returns the value formatted with the following rules:

* Returns `formatInteger(x)` if `x` is an integer defined by `parseInt(x) === parseFloat(x)`.
* Returns `formatDecimal(x)` otherwise.

|               Input Value |       toLocaleString |    toPrecision (N=3) |         Rule of Four |               format |
|               ----------- |       -------------- |    ----------------- |         ------------ |               ------ |
|                      0.04 |                 0.04 |               0.0400 |                0.040 |                0.040 |
|                       0.2 |                  0.2 |                0.200 |                0.200 |                0.200 |
|                       0.4 |                  0.4 |                0.400 |                 0.40 |                 0.40 |
|                   2.00001 |                    2 |                 2.00 |                 2.00 |                 2.00 |
|                   4.00001 |                    4 |                 4.00 |                  4.0 |                 4.00 |
|                   20.0001 |                   20 |                 20.0 |                 20.0 |                20.00 |
|                   40.0001 |                   40 |                 40.0 |                   40 |                40.00 |
|                         2 |                    2 |                 2.00 |                 2.00 |                    2 |
|                         4 |                    4 |                 4.00 |                  4.0 |                    4 |
|                        20 |                   20 |                 20.0 |                 20.0 |                   20 |
|                        40 |                   40 |                 40.0 |                   40 |                   40 |
|                         0 |                    0 |                 0.00 |                 0.00 |                    0 |
|                        -0 |                    0 |                 0.00 |                 0.00 |                   -0 |
|                  Infinity |                    ∞ |             Infinity |             Infinity |                    ∞ |
|                 -Infinity |                   -∞ |            -Infinity |            -Infinity |                   -∞ |

Other sample outputs below:

### Integers

|               Input Value |       toLocaleString |    toPrecision (N=3) |         Rule of Four |               format |
|               ----------- |       -------------- |    ----------------- |         ------------ |               ------ |
|                         5 |                    5 |                 5.00 |                  5.0 |                    5 |
|                        39 |                   39 |                 39.0 |                 39.0 |                   39 |
|                        70 |                   70 |                 70.0 |                   70 |                   70 |
|                       310 |                  310 |                  310 |                  310 |                  310 |
|                       541 |                  541 |                  541 |               5.4e+2 |                  541 |
|                      4646 |                4,646 |              4.65e+3 |               4.6e+3 |                4,646 |
|                      9566 |                9,566 |              9.57e+3 |               9.6e+3 |                9,566 |
|                      8440 |                8,440 |              8.44e+3 |               8.4e+3 |                8,440 |
|                     23401 |               23,401 |              2.34e+4 |              2.34e+4 |               23,401 |
|                    227345 |              227,345 |              2.27e+5 |              2.27e+5 |              227,345 |
|                    158154 |              158,154 |              1.58e+5 |              1.58e+5 |              158,154 |
|                   2039981 |            2,039,981 |              2.04e+6 |              2.04e+6 |            2,039,981 |
|                   5032575 |            5,032,575 |              5.03e+6 |               5.0e+6 |            5,032,575 |
|                  39289988 |           39,289,988 |              3.93e+7 |              3.93e+7 |             3.929e+7 |
|                  35422799 |           35,422,799 |              3.54e+7 |              3.54e+7 |             3.542e+7 |
|                 462319693 |          462,319,693 |              4.62e+8 |               4.6e+8 |              4.62e+8 |
|                        -4 |                   -4 |                -4.00 |                 -4.0 |                   -4 |
|                        -3 |                   -3 |                -3.00 |                -3.00 |                   -3 |
|                       -50 |                  -50 |                -50.0 |                  -50 |                  -50 |
|                        -1 |                   -1 |                -1.00 |                -1.00 |                   -1 |
|                      -694 |                 -694 |                 -694 |              -6.9e+2 |                 -694 |
|                      -833 |                 -833 |                 -833 |              -8.3e+2 |                 -833 |
|                       -88 |                  -88 |                -88.0 |                  -88 |                  -88 |
|                     -6417 |               -6,417 |             -6.42e+3 |              -6.4e+3 |               -6,417 |
|                    -70583 |              -70,583 |             -7.06e+4 |              -7.1e+4 |              -70,583 |
|                   -126697 |             -126,697 |             -1.27e+5 |             -1.27e+5 |             -126,697 |
|                   -387540 |             -387,540 |             -3.88e+5 |             -3.88e+5 |             -387,540 |
|                  -2362875 |           -2,362,875 |             -2.36e+6 |             -2.36e+6 |            -2.363e+6 |
|                   -616173 |             -616,173 |             -6.16e+5 |              -6.2e+5 |             -616,173 |
|                 -32706951 |          -32,706,951 |             -3.27e+7 |             -3.27e+7 |            -3.271e+7 |
|                 -70843501 |          -70,843,501 |             -7.08e+7 |              -7.1e+7 |             -7.08e+7 |
|                -438418013 |         -438,418,013 |             -4.38e+8 |              -4.4e+8 |             -4.38e+8 |

### Floats

|               Input Value |       toLocaleString |    toPrecision (N=3) |         Rule of Four |               format |
|               ----------- |       -------------- |    ----------------- |         ------------ |               ------ |
|       0.35709116330142554 |                0.357 |                0.357 |                0.357 |                0.357 |
|         2.422140230678407 |                2.422 |                 2.42 |                 2.42 |                 2.42 |
|         6.576883150837151 |                6.577 |                 6.58 |                  6.6 |                 6.58 |
|        38.253397365074534 |               38.253 |                 38.3 |                 38.3 |                38.25 |
|         65.78696294051636 |               65.787 |                 65.8 |                   66 |                65.79 |
|         490.4974743402553 |              490.497 |                  490 |               4.9e+2 |               490.50 |
|         541.1846347854686 |              541.185 |                  541 |               5.4e+2 |               541.18 |
|         649.5709007389661 |              649.571 |                  650 |               6.5e+2 |               649.57 |
|         851.1656303787806 |              851.166 |                  851 |               8.5e+2 |               851.17 |
|        48313.463629611026 |           48,313.464 |              4.83e+4 |               4.8e+4 |            48,313.46 |
|         35882.57412693732 |           35,882.574 |              3.59e+4 |              3.59e+4 |            35,882.57 |
|        489826.35998219484 |           489,826.36 |              4.90e+5 |               4.9e+5 |              4.90e+5 |
|        439878.72606405773 |          439,878.726 |              4.40e+5 |               4.4e+5 |              4.40e+5 |
|          492891.285048459 |          492,891.285 |              4.93e+5 |               4.9e+5 |              4.93e+5 |
|         2991720.620193388 |         2,991,720.62 |              2.99e+6 |              2.99e+6 |             2.992e+6 |
|        1368557.3398692363 |         1,368,557.34 |              1.37e+6 |              1.37e+6 |             1.369e+6 |
|         98057541.27415393 |       98,057,541.274 |              9.81e+7 |               9.8e+7 |              9.81e+7 |
|        176949830.52112678 |      176,949,830.521 |              1.77e+8 |              1.77e+8 |             1.769e+8 |
|       0.02224951206815953 |                0.022 |               0.0222 |               0.0222 |               0.0222 |
|       0.11539629567456433 |                0.115 |                0.115 |                0.115 |                0.115 |
|     0.0055453656788730975 |                0.006 |              0.00555 |               0.0055 |               0.0055 |
|     0.0052660868347035655 |                0.005 |              0.00527 |               0.0053 |               0.0053 |
|     0.0009624349508786467 |                0.001 |             0.000962 |              0.00096 |              0.00096 |
|      0.001185090921563161 |                0.001 |              0.00119 |              0.00119 |              0.00119 |
|   0.000011465205485020126 |                    0 |            0.0000115 |            0.0000115 |            0.0000115 |
|     0.0003037170027846994 |                    0 |             0.000304 |             0.000304 |             0.000304 |
|   0.000005178407446885407 |                    0 |           0.00000518 |            0.0000052 |            0.0000052 |
|   0.000010697601372224997 |                    0 |            0.0000107 |            0.0000107 |            0.0000107 |
|      3.984382086935969e-7 |                    0 |              3.98e-7 |              3.98e-7 |              3.98e-7 |
|  0.0000012221981255532144 |                    0 |           0.00000122 |           0.00000122 |             1.222e-6 |
|      5.853176095762757e-8 |                    0 |              5.85e-8 |               5.9e-8 |               5.9e-8 |
|      6.103391247906431e-8 |                    0 |              6.10e-8 |               6.1e-8 |               6.1e-8 |
|      9.149889791987333e-9 |                    0 |              9.15e-9 |               9.1e-9 |               9.1e-9 |
|     2.7806518451645568e-8 |                    0 |              2.78e-8 |              2.78e-8 |              2.78e-8 |
|       -0.5644587399862708 |               -0.564 |               -0.564 |                -0.56 |                -0.56 |
|       -0.5537402768414046 |               -0.554 |               -0.554 |                -0.55 |                -0.55 |
|        -8.172859891661808 |               -8.173 |                -8.17 |                 -8.2 |                -8.17 |
|        -8.138061769221604 |               -8.138 |                -8.14 |                 -8.1 |                -8.14 |
|        -56.85274258973079 |              -56.853 |                -56.9 |                  -57 |               -56.85 |
|        -309.5605831277185 |             -309.561 |                 -310 |                 -310 |              -309.56 |
|        -516.4268655208533 |             -516.427 |                 -516 |              -5.2e+2 |              -516.43 |
|        -3743.281870006126 |           -3,743.282 |             -3.74e+3 |             -3.74e+3 |            -3,743.28 |
|        -4561.949106393042 |           -4,561.949 |             -4.56e+3 |              -4.6e+3 |            -4,561.95 |
|       -48890.437705130695 |          -48,890.438 |             -4.89e+4 |              -4.9e+4 |             -4.89e+4 |
|        -14907.19749729188 |          -14,907.197 |             -1.49e+4 |             -1.49e+4 |            -1.491e+4 |
|         -213255.061606207 |         -213,255.062 |             -2.13e+5 |             -2.13e+5 |            -2.133e+5 |
|        -837887.7985669249 |         -837,887.799 |             -8.38e+5 |              -8.4e+5 |             -8.38e+5 |
|        -2962105.679039194 |       -2,962,105.679 |             -2.96e+6 |             -2.96e+6 |            -2.962e+6 |
|        -3014262.406233126 |       -3,014,262.406 |             -3.01e+6 |             -3.01e+6 |            -3.014e+6 |
|       -25775097.741995037 |      -25,775,097.742 |             -2.58e+7 |             -2.58e+7 |            -2.578e+7 |
|        -37284864.83410851 |      -37,284,864.834 |             -3.73e+7 |             -3.73e+7 |            -3.728e+7 |
|       -125198340.07011376 |      -125,198,340.07 |             -1.25e+8 |             -1.25e+8 |            -1.252e+8 |
|     -0.016538390133683547 |               -0.017 |              -0.0165 |              -0.0165 |              -0.0165 |
|      -0.09027691207424449 |                -0.09 |              -0.0903 |               -0.090 |               -0.090 |
|      -0.00555834448592438 |               -0.006 |             -0.00556 |              -0.0056 |              -0.0056 |
|    -0.0026228020205174675 |               -0.003 |             -0.00262 |             -0.00262 |             -0.00262 |
|   -0.00013034017373241547 |                   -0 |            -0.000130 |            -0.000130 |            -0.000130 |
|     -0.002315553350903113 |               -0.002 |             -0.00232 |             -0.00232 |             -0.00232 |
|  -0.000017974374650788062 |                   -0 |           -0.0000180 |           -0.0000180 |            -1.797e-5 |
|   -0.00046164465815655425 |                   -0 |            -0.000462 |             -0.00046 |             -0.00046 |
|   -0.00000775800223570485 |                   -0 |          -0.00000776 |           -0.0000078 |             -7.76e-6 |
|   -0.00001839490183778365 |                   -0 |           -0.0000184 |           -0.0000184 |            -1.839e-5 |
|     -6.309769090799477e-7 |                   -0 |             -6.31e-7 |              -6.3e-7 |              -6.3e-7 |
|  -0.000001949049901968154 |                   -0 |          -0.00000195 |          -0.00000195 |            -1.949e-6 |
|     -5.108303124750717e-8 |                   -0 |             -5.11e-8 |              -5.1e-8 |              -5.1e-8 |
|     -4.326701309743414e-7 |                   -0 |             -4.33e-7 |              -4.3e-7 |              -4.3e-7 |
|     -9.994031953804334e-9 |                   -0 |             -9.99e-9 |              -1.0e-8 |              -1.0e-8 |
|     -4.203304833015517e-8 |                   -0 |             -4.20e-8 |              -4.2e-8 |              -4.2e-8 |

### Special

|               Input Value |       toLocaleString |    toPrecision (N=3) |         Rule of Four |               format |
|               ----------- |       -------------- |    ----------------- |         ------------ |               ------ |
|                       NaN |                  NaN |                  NaN |                  NaN |                  NaN |
|                     1 + 2 |                    3 |                 3.00 |                 3.00 |                    3 |
|            (0.1 + 0.2)*10 |                    3 |                 3.00 |                 3.00 |                 3.00 |
|                        PI |                3.142 |                 3.14 |                 3.14 |                 3.14 |
|                         E |                2.718 |                 2.72 |                 2.72 |                 2.72 |
|                     SQRT2 |                1.414 |                 1.41 |                 1.41 |                 1.41 |
|                   EPSILON |                    0 |             2.22e-16 |             2.22e-16 |             2.22e-16 |
